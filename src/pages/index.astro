---
import { type CollectionEntry, getCollection } from "astro:content";
import SocialList from "@/components/SocialList.astro";
// import PostPreview from "@/components/blog/PostPreview.astro";
import ArticlePreview from "@/components/ArticlePreview.astro";
import Note from "@/components/note/Note.astro";
// import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";
import { getAllArticles } from "@/utils/article";
import { Image } from "astro:assets";
import myImage from "@/assets/me.png";

// Posts
// const MAX_POSTS = 10;
// const allPosts = await getAllPosts();
// const allPostsByDate = allPosts
// 	.sort(collectionDateSort)
// 	.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Articles
const MAX_ARTICLES = 5;
const allArticles = await getAllArticles();
const allArticlesByDate = allArticles
	.sort(collectionDateSort)
	.slice(0, MAX_ARTICLES) as CollectionEntry<"article">[];

// Notes
const MAX_NOTES = 5;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<div class="h-card grid grid-cols-5 gap-3">
			<Image src={myImage} alt="Memoji of myself" class="u-photo" />
			<p class="p-note col-span-4 mb-4">
				Hi, I'm <a class="p-name u-uid u-url" rel="me" href="https://www.niklas.fyi"
					><span class="p-given-name">Niklas</span><span
						class="p-family-name"
						style="display: none;">&nbsp;Siefke</span
					></a
				> (<span class="p-pronouns"
					><span class="p-x-pronoun-nominative p-pronoun-nominative p-pronoun">he</span>/<span
						class="p-pronoun-oblique p-x-pronoun-oblique">him</span
					>/<span class="p-pronoun-possessive p-x-pronoun-possessive">his</span></span
				>), <span class="p-job-title">Software Engineer</span> at <a
					class="p-org h-card"
					href="https://www.mazemap.com/">MazeMap</a
				>. Living a quite life in <span class="p-locality">Trondheim</span> (ðŸ‡³ðŸ‡´<span
					class="p-country-name"
					style="display: none;">Norway</span
				>) | Dad - Dogperson - Dedicated Photographer - Smart Home Tinkerer
			</p>
		</div>
		<SocialList />
	</section>
	{
		allArticlesByDate.length > 0 && (
			<section class="mt-16">
				<h2 class="title text-accent mb-6 text-xl">
					<a href="/articles/">Articles</a>
				</h2>
				<ul class="space-y-6" role="list">
					{allArticlesByDate.map((article) => (
						<li class="grid gap-2 sm:grid-cols-[auto_1fr]">
							<ArticlePreview article={article} />
						</li>
					))}
				</ul>
			</section>
		)
	}
	{
		latestNotes.length > 0 && (
			<section class="mt-16">
				<h2 class="title text-accent mb-6 text-xl">
					<a href="/notes/">Notes</a>
				</h2>
				<ul class="space-y-6" role="list">
					{latestNotes.map((note) => (
						<li>
							<Note note={note} as="h3" isPreview />
						</li>
					))}
				</ul>
			</section>
		)
	}
</PageLayout>
